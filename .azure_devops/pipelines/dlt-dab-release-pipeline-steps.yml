steps:
  - task: ExtractFiles@1
    inputs:
      archiveFilePatterns: "$(Pipeline.Workspace)/buildpl/drop/$(resources.pipeline.buildpl.runID).zip"
      destinationFolder: "$(Pipeline.Workspace)"
      cleanDestinationFolder: false

  - script: |
      curl -fsSL https://raw.githubusercontent.com/databricks/setup-cli/main/install.sh | sh
    workingDirectory: "$(System.DefaultWorkingDirectory)"
    displayName: "Install Databricks CLI"

  - script: |
      databricks bundle deploy --target $(TARGET)
    env:
      DATABRICKS_HOST: $(DATABRICKS_HOST)
      DATABRICKS_CLIENT_ID: $(DATABRICKS_CLIENT_ID)
      DATABRICKS_CLIENT_SECRET: $(DATABRICKS_CLIENT_SECRET)
    workingDirectory: "$(Pipeline.Workspace)"
    displayName: "Deploy bundle"
