steps:
  - checkout: self
    persistCredentials: true
    clean: true
    fetchDepth: 0
    displayName: "Checkout & Build.Reason: $(Build.Reason) & Build.SourceBranchName: $(Build.SourceBranchName)"

  - script: |
      curl -fsSL https://raw.githubusercontent.com/databricks/setup-cli/main/install.sh | sh
    workingDirectory: "$(System.DefaultWorkingDirectory)"
    displayName: "Install Databricks CLI"

  - script: |
      databricks bundle deploy --target $(TARGET)
    env:
      DATABRICKS_HOST: $(_DATABRICKS_HOST)
      DATABRICKS_CLIENT_ID: $(_DATABRICKS_CLIENT_ID)
      DATABRICKS_CLIENT_SECRET: $(_DATABRICKS_CLIENT_SECRET)
    workingDirectory: "$(Pipeline.Workspace)"
    displayName: "Deploy bundle"
